<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Chleb na zakwasie — Kalkulator zawartości glutenu i hydratacji ciasta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 1rem;
      line-height: 1.4;
    }

    h1 { font-size: 1.35rem; margin-bottom: 0.3rem; }
    h2 { font-size: 1.1rem; margin-top: 1.2rem; margin-bottom: 0.4rem; }

    .section {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 0.8rem;
      margin-bottom: 1rem;
    }

    label {
      font-size: 0.86rem;
    }

    input[type="number"],
    input[type="text"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.35rem 0.45rem;
      font-size: 0.86rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    /* Pola edytowalne */
    input:not([readonly]),
    textarea:not([readonly]) {
      background-color: #e6f4ff;
      transition: background-color 0.15s, box-shadow 0.15s, border-color 0.15s;
    }

    input:not([readonly]):focus,
    textarea:not([readonly]):focus {
      background-color: #d8eeff;
      box-shadow: 0 0 0 2px #99cfff;
      border-color: #66aef5;
      outline: none;
    }

    /* Pola readonly – szare */
    input[readonly] {
      background-color: #f5f5f5;
      border-color: #ddd;
      cursor: default;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 0.3rem 0.6rem;
      max-width: 650px;
      align-items: center;
    }

    .btn {
      margin-top: 0.4rem;
      padding: 0.4rem 0.8rem;
      font-size: 0.82rem;
      border-radius: 999px;
      border: 1px solid #777;
      background: #f3f3f3;
      cursor: pointer;
    }

    .btn:hover {
      background: #e8e8e8;
    }

    .output {
      font-weight: 600;
      background-color: #f5f5f5;
      border: 1px solid #ddd;
      padding: 0.25rem 0.35rem;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      min-height: 1.8rem;
    }

    /* --- TABELA MĄK --- */
    .flour-row {
      display: grid;
      grid-template-columns: 1fr 0.8fr 0.8fr 0.8fr 0.9fr;
      gap: 0.3rem;
      margin-bottom: 0.3rem;
      max-width: 900px;
    }

    .flour-header {
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .hint {
      font-size: 0.8rem;
      color: #555;
      margin-bottom: 0.4rem;
    }

    #recipeSummary {
      min-height: 150px;
      resize: vertical;
    }
  </style>
</head>

<body>

<h1>Chleb na zakwasie</h1>
<div style="font-size: 0.95rem; color:#444; margin-bottom:1rem;">
  <strong>Kalkulator zawartości glutenu i hydratacji ciasta</strong>
</div>

<!-- 1. SUMA SUCHYCH -->
<div class="section">
  <h2>1. Łączna masa mąki</h2>

  <div class="grid">
    <label for="totalDry">Łączna masa mieszanki mąk (i glutenu, jeśli jest suplementowany) [g]</label>
    <input type="number" id="totalDry" step="1" min="0" oninput="updateScaleButton(); recalc();">
  </div>
</div>

<!-- 2. KOMPOZYCJA MĄK -->
<div class="section">
  <h2>2. Kompozycja mąk</h2>

  <div class="flour-row flour-header">
    <div>Typ</div>
    <div>Ilość [g]</div>
    <div>Udział [%]</div>
    <div>Zawartość białka / 100g</div>
    <div>Gluten z mąki [g]</div>
  </div>

  <div class="flour-row">
    <input type="text" id="flourName1" placeholder="np. T110" oninput="recalc()">
    <input type="number" id="m1" step="1" min="0" oninput="recalc()">
    <input type="number" id="pct1" readonly>
    <input type="number" id="p1" step="0.1" min="0" oninput="recalc()">
    <input type="number" id="g1" readonly>
  </div>

  <div class="flour-row">
    <input type="text" id="flourName2" placeholder="np. T80 ancient" oninput="recalc()">
    <input type="number" id="m2" step="1" min="0" oninput="recalc()">
    <input type="number" id="pct2" readonly>
    <input type="number" id="p2" step="0.1" min="0" oninput="recalc()">
    <input type="number" id="g2" readonly>
  </div>

  <div class="flour-row">
    <input type="text" id="flourName3" placeholder="np. T65" oninput="recalc()">
    <input type="number" id="m3" step="1" min="0" oninput="recalc()">
    <input type="number" id="pct3" readonly>
    <input type="number" id="p3" step="0.1" min="0" oninput="recalc()">
    <input type="number" id="g3" readonly>
  </div>
</div>

<!-- 3. GLUTEN -->
<div class="section">
  <h2>3. Zawartość i ewentualna suplementacja glutenu</h2>

  <p class="hint">
    Po dodaniu glutenu możesz użyć przycisku „Przeskaluj”, aby automatycznie dostosować masę suchych produktów do podanej powyżej masy docelowej.
  </p>

  <div class="grid">
    <label for="glutenProd">Dodany gluten witalny (80%) [g]</label>
    <input type="number" id="glutenProd" step="0.5" min="0" oninput="recalc()">

    <span>Łączna masa mąki i dodanego glutenu [g]</span>
    <span class="output" id="sumDryDisplay">–</span>

    <!-- Przeniesiony przycisk -->
    <button class="btn" id="scaleBtn" type="button"
            onclick="scaleFlours()"
            style="grid-column: 1 / -1; margin-top: 0.5rem;">
      Przeskaluj
    </button>

    <span>Zawartość glutenu w mieszance [g]</span>
    <span class="output" id="sumGlutenDisplay">–</span>

    <span>Zawartość glutenu w mieszance [%]</span>
    <span class="output" id="glutenPercentDisplay">–</span>
  </div>
</div>

<!-- 4. LEVAIN -->
<div class="section">
  <h2>4. Zakwas / levain</h2>

  <p class="hint">
    Zwykle hydratacja zakwasu wynosi 100%, gdyż do jego sporządzenia często używa się równych proporcji mąki i wody.
  </p>

  <div class="grid">
    <label for="levain">Levain / zakwas [g]</label>
    <input type="number" id="levain" step="1" min="0" oninput="recalc()">

    <label for="levainHydro">Hydratacja levain [%]</label>
    <input type="number" id="levainHydro" step="1" min="0" oninput="recalc()">

    <span>Mąka w levain [g]</span>
    <span class="output" id="levainFlourDisplay">–</span>

    <span>Woda w levain [g]</span>
    <span class="output" id="levainWaterDisplay">–</span>
  </div>
</div>

<!-- 5. HYDRATACJA CIASTA -->
<div class="section">
  <h2>5. Hydratacja ciasta</h2>

  <div class="grid">

    <label for="targetHydro">Docelowa hydratacja ciasta [%]</label>
    <input type="number" id="targetHydro" step="0.5" min="0" oninput="recalc()">

    <!-- Woda do dodania — tuż pod hydratacją -->
    <span>Woda do dodania do ciasta [g]</span>
    <span class="output" id="addedWaterDisplay">–</span>

    <span>Całkowita mąka (mąki + gluten + mąka z levain) [g]</span>
    <span class="output" id="totalFlourDisplay">–</span>

    <span>Całkowita woda (w tym levain) [g]</span>
    <span class="output" id="totalWaterDisplay">–</span>
  </div>
</div>

<!-- 6. PODSUMOWANIE -->
<div class="section">
  <h2>6. Podsumowanie przepisu</h2>

  <button class="btn" type="button" onclick="generateRecipe()">ZAPISZ PRZEPIS</button>
  <button class="btn" type="button" onclick="clearFields()">WYCZYŚĆ POLA</button>

  <textarea id="recipeSummary" readonly placeholder="Tutaj pojawi się podsumowanie przepisu..."></textarea>
</div>


<script>
/* ---------------- HELPERY ---------------- */

function num(id) {
  let el = document.getElementById(id);
  if (!el) return 0;
  let raw = (el.value || "").replace(",", ".");
  let v = parseFloat(raw);
  return isNaN(v) ? 0 : v;
}

function setValue(id, val, decimals = 1) {
  let el = document.getElementById(id);
  if (!el) return;
  if (typeof val === "number" && !isNaN(val))
    el.value = val.toFixed(decimals);
  else el.value = "";
}

function setText(id, val, decimals = 1) {
  let el = document.getElementById(id);
  if (!el) return;
  if (typeof val === "number" && !isNaN(val))
    el.textContent = val.toFixed(decimals);
  else el.textContent = "–";
}


/* ---------------- PRZELICZENIA ---------------- */

function recalc() {
  let m1 = num("m1"), m2 = num("m2"), m3 = num("m3");
  let p1 = num("p1"), p2 = num("p2"), p3 = num("p3");
  let Gprod = num("glutenProd");

  /* GLUTEN Z MĄK */
  let g1 = m1 * p1 / 100;
  let g2 = m2 * p2 / 100;
  let g3 = m3 * p3 / 100;

  setValue("g1", g1);
  setValue("g2", g2);
  setValue("g3", g3);

  /* UDZIAŁY % */
  let totalFlourBlend = m1 + m2 + m3;

  if (totalFlourBlend > 0) {
    setValue("pct1", m1 / totalFlourBlend * 100, 1);
    setValue("pct2", m2 / totalFlourBlend * 100, 1);
    setValue("pct3", m3 / totalFlourBlend * 100, 1);
  } else {
    setValue("pct1", "");
    setValue("pct2", "");
    setValue("pct3", "");
  }

  /* SUMA SUCHYCH */
  let sumDry = m1 + m2 + m3 + Gprod;
  let sumGluten = g1 + g2 + g3 + Gprod * 0.8;
  let glutenPercent = sumDry > 0 ? (sumGluten / sumDry * 100) : NaN;

  setText("sumDryDisplay", sumDry);
  setText("sumGlutenDisplay", sumGluten);
  setText("glutenPercentDisplay", glutenPercent, 2);

  /* LEVAIN */
  let L = num("levain");
  let Lh = num("levainHydro");
  let levainFlour = 0;
  let levainWater = 0;

  if (L > 0 && Lh > 0) {
    levainFlour = L / (1 + Lh / 100);
    levainWater = L - levainFlour;
  }

  setText("levainFlourDisplay", levainFlour);
  setText("levainWaterDisplay", levainWater);

  /* HYDRATACJA */
  let totalFlour = sumDry + levainFlour;
  let targetHydro = num("targetHydro");

  let totalWater = (!isNaN(targetHydro) && targetHydro > 0)
    ? totalFlour * targetHydro / 100
    : NaN;

  let addedWater = (!isNaN(totalWater))
    ? Math.max(0, totalWater - levainWater)
    : NaN;

  setText("totalFlourDisplay", totalFlour);
  setText("totalWaterDisplay", totalWater);
  setText("addedWaterDisplay", addedWater);
}


/* ---------------- PRZESKALOWANIE ---------------- */

function updateScaleButton() {
  let T = num("totalDry");
  let btn = document.getElementById("scaleBtn");

  if (T > 0)
    btn.textContent = `Przeskaluj do zamierzonej masy ${T} g`;
  else
    btn.textContent = "Przeskaluj";
}

function scaleFlours() {
  let T = num("totalDry");
  let G = num("glutenProd");

  if (T <= 0) {
    alert("Najpierw ustaw łączną masę mąki i glutenu.");
    return;
  }

  let m1 = num("m1"), m2 = num("m2"), m3 = num("m3");
  let F = m1 + m2 + m3;

  if (F <= 0) {
    alert("Najpierw wpisz ilości mąk.");
    return;
  }

  let flourTarget = T - G;
  if (flourTarget < 0) {
    alert("Glutenu jest więcej niż masa docelowa! Zmniejsz gluten lub zwiększ masę.");
    return;
  }

  let k = flourTarget / F;

  setValue("m1", m1 * k);
  setValue("m2", m2 * k);
  setValue("m3", m3 * k);

  recalc();
}


/* ---------------- CZYSZCZENIE ---------------- */

function clearFields() {
  [
    "totalDry", "flourName1", "flourName2", "flourName3",
    "m1","m2","m3","p1","p2","p3",
    "glutenProd","levain","levainHydro","targetHydro"
  ].forEach(id => {
    let el = document.getElementById(id);
    if (el) el.value = "";
  });

  ["pct1","pct2","pct3","g1","g2","g3"].forEach(id => {
    let el = document.getElementById(id);
    if (el) el.value = "";
  });

  [
    "sumDryDisplay","sumGlutenDisplay","glutenPercentDisplay",
    "levainFlourDisplay","levainWaterDisplay",
    "totalFlourDisplay","totalWaterDisplay","addedWaterDisplay"
  ].forEach(id => {
    let el = document.getElementById(id);
    if (el) el.textContent = "–";
  });

  document.getElementById("recipeSummary").value = "";
  updateScaleButton();
  recalc();
}


/* ---------------- GENERATOR PRZEPISU ---------------- */

function generateRecipe() {
  let lines = [];

  let totalDry = num("totalDry");
  let m1 = num("m1"), m2 = num("m2"), m3 = num("m3");
  let p1 = num("p1"), p2 = num("p2"), p3 = num("p3");
  let G = num("glutenProd");
  let L = num("levain");
  let Lh = num("levainHydro");
  let targetHydro = num("targetHydro");

  let fn1 = document.getElementById("flourName1").value || "Mąka 1";
  let fn2 = document.getElementById("flourName2").value || "Mąka 2";
  let fn3 = document.getElementById("flourName3").value || "Mąka 3";

  let sumDryText = document.getElementById("sumDryDisplay").textContent;
  let sumGlutenText = document.getElementById("sumGlutenDisplay").textContent;
  let glutenPctText = document.getElementById("glutenPercentDisplay").textContent;
  let levFlourText = document.getElementById("levainFlourDisplay").textContent;
  let levWaterText = document.getElementById("levainWaterDisplay").textContent;
  let totalFlourText = document.getElementById("totalFlourDisplay").textContent;
  let totalWaterText = document.getElementById("totalWaterDisplay").textContent;
  let addedWaterText = document.getElementById("addedWaterDisplay").textContent;

  lines.push("PRZEPIS – chleb na zakwasie\n");

  if (totalDry > 0)
    lines.push("Łączna masa mąki i glutenu: " + totalDry.toFixed(1) + " g\n");

  lines.push("Kompozycja mąk:");
  if (m1 > 0) lines.push(`- ${fn1}: ${m1.toFixed(1)} g (${p1.toFixed(1)} g białka / 100g)`);
  if (m2 > 0) lines.push(`- ${fn2}: ${m2.toFixed(1)} g (${p2.toFixed(1)} g białka / 100g)`);
  if (m3 > 0) lines.push(`- ${fn3}: ${m3.toFixed(1)} g (${p3.toFixed(1)} g białka / 100g)`);
  if (G > 0) lines.push(`- Gluten witalny (80%): ${G.toFixed(1)} g`);

  lines.push("\nZawartość glutenu:");
  if (sumDryText !== "–") lines.push("- Łączna masa mąki i dodanego glutenu: " + sumDryText + " g");
  if (sumGlutenText !== "–") lines.push("- Zawartość glutenu w mieszance: " + sumGlutenText + " g");
  if (glutenPctText !== "–") lines.push("- Procentowa zawartość glutenu: " + glutenPctText + "%");

  lines.push("\nZakwas / levain:");
  if (L > 0) lines.push("- Ilość levain: " + L.toFixed(1) + " g");
  if (Lh > 0) lines.push("- Hydratacja levain: " + Lh.toFixed(1) + "%");
  if (levFlourText !== "–") lines.push("- Mąka w levain: " + levFlourText + " g");
  if (levWaterText !== "–") lines.push("- Woda w levain: " + levWaterText + " g");

  lines.push("\nHydratacja ciasta:");
  if (targetHydro > 0) lines.push("- Docelowa hydratacja: " + targetHydro.toFixed(1) + "%");
  if (totalFlourText !== "–") lines.push("- Całkowita mąka: " + totalFlourText + " g");
  if (totalWaterText !== "–") lines.push("- Całkowita woda: " + totalWaterText + " g");
  if (addedWaterText !== "–") lines.push("- Woda do dodania: " + addedWaterText + " g");

  document.getElementById("recipeSummary").value = lines.join("\n");
}


/* INIT */
updateScaleButton();
recalc();
</script>


</body>
</html>
